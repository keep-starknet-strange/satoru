# Utils module

The Utils module is a various collection of utility functions and tools designed to streamline various tasks within the protocol. This module serves as a repository for functions that do not fit into specific categories but are essential for enhancing the efficiency and readability of the codebase.

It contains the following files:

- [account_utils.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/account_utils.cairo): This file serves as a utility file in the project, containing functions to validate accounts and receivers within the system. It includes methods such as `validate_account` and `validate_receiver` to ensure that the accounts involved in various operations are valid and non-zero, enhancing the security and robustness of interactions within the system. This validation is crucial to prevent errors and vulnerabilities related to invalid or null account interactions.

- [array.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/array.cairo): This file is a utility in the project, providing a suite of functions for sophisticated array manipulations and operations, which is essential for handling data structures within the contract. It contains various functions, like `get_felt252` and `get_u128` for safely retrieving elements from an array, and comparison functions like `are_eq`, `are_gt`, `are_gte`, `are_lt`, `are_lte` which are used for comparing each element of an array to a specified value. It also has functions like `get_median` for statistical analysis of array elements and `get_uncompacted_value` for extracting uncompacted values from compacted ones. This file is crucial for ensuring that array operations are executed securely and efficiently, preventing potential errors related to array manipulations.

- [basic_multicall.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/basic_multicall.cairo): This utility is tailored to manage and execute batches of function calls on a contract, allowing multiple operations to be performed in a single transaction. It is crucial for optimizing gas utilization and enhancing the efficiency of smart contract interactions. The `multicall` function within this file receives an array of function calls and executes them sequentially. It asserts that the length of the array of calls is greater than zero, ensuring there is data to process, and then iterates over each call, executing them and appending the results to an array. This function is essential for performing multiple operations efficiently and is instrumental in maintaining the robustness and responsiveness of the contract in various scenarios.

- [bits.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/bits.cairo): This file contains constants representing bitmasks for different binary word sizes. These constants, `BITMASK_8`, `BITMASK_16`, `BITMASK_32`, and `BITMASK_64`, are designed to facilitate bit-level operations such as bit shifting, bitwise AND, OR, and XOR on `u128` type values within the contract's code. These bitmasks are crucial for performing precise, low-level manipulations of binary data, enabling the effective handling of binary information and the implementation of optimized, robust solutions.

- [calc.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/calc.cairo): This file provides a suite of utility functions designed to perform various mathematical calculations and type conversions. It contains functions for rounded-up division, summing numbers with specific return types, calculating the absolute difference between two numbers, and bounded addition and subtraction to prevent overflow and underflow. It also features functions to convert between signed and unsigned integers, ensuring precise and safe calculations are made throughout the contract's code. These utility functions are crucial for maintaining the accuracy and reliability of the mathematical operations performed within the protocol.

- [enumerable_set.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/enumerable_set.cairo): This file defines a versatile and type-specific `Set` data structure that provides methods for managing and manipulating collections of unique elements. It allows the creation of new sets, addition and removal of elements, checks for set membership, access to elements at specific positions, and retrieval of all elements as an array. The file contains specific implementations for handling sets of `felt252`, `ContractAddress`, and `u128` types, ensuring adaptability and precise management of different data types within the protocol's ecosystem. The provided set operations are essential for various functionalities and logic implementations within the project, allowing efficient and organized management of unique collections.

- [enumerable_values.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/enumerable_values.cairo): This file serves as an extension to `EnumerableSet`, potentially providing enhanced and specialized functionalities to handle enumerable sets within the system. It contains placeholder methods intended to return arrays of values of specific types (`felt252`, `ContractAddress`, `u128`) from a given set, between specified start and end indices. Although the methods are currently not implemented and return empty arrays, once completed, they will offer precise and flexible ways to access and manipulate subsets of values in enumerable sets, contributing to effective data handling and interaction in the protocol.

- [error_utils.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/error_utils.cairo): This file is dedicated to providing functionalities related to error handling within the system. It currently contains skeleton functions intended for retrieving error selectors and generating custom revert messages based on specific error data, which once implemented, will offer enhanced error reporting and handling capabilities. Additionally, it includes a fully implemented function, `check_division_by_zero`, which verifies whether the divisor in a division operation is zero and triggers a panic with a meaningful error message if a division by zero is attempted, aiding in robust and safe arithmetic operations within the protocol.

- [error.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/error.cairo): This file defines constants for various types of errors, serving as standardized error messages or codes that can be referenced throughout the system to indicate specific error conditions. It contains two error modules: `ReentrancyGuardError` for signaling conditions where a reentrant call is detected, and `UtilsError` for indicating diverse issues such as null accounts, null receivers, mask index problems, and absence of data for multicalls, helping in maintaining clarity and consistency in error reporting across the system.

- [global_reentrancy_guard.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/global_reentrancy_guard.cairo): This file implements a global-level reentrancy guard to secure smart contract functions against reentrancy attacks. It uses a global flag, `REENTRANCY_GUARD_STATUS`, to indicate whether a protected function is currently executing, and provides `non_reentrant_before` and `non_reentrant_after` methods to set and reset this flag, preventing malicious reentrant calls and ensuring consistent state throughout the smart contract's execution.

- [hash.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/hash.cairo): This file provides utility functions for hashing, specifically using the Poseidon hash function. It includes a function, `hash_poseidon_single`, which allows hashing a single `felt252` value using Poseidon, ensuring data integrity and catering to cryptographic needs in the smart contract.

- [i128_test_storage_contract.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/i128_test_storage_contract.cairo): This file defines a StarkNet contract intended to test the storage and retrieval of `i128` values in the contract state. It serves as a test utility to ensure correct handling of `i128` values in the smart contract environment.

- [i128.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/i128.cairo): This file provides implementations for handling `i128` (signed 128-bit integers) in Cairo, including arithmetic operations, serialization, deserialization, and storage management, enabling the efficient and accurate handling of `i128` values in StarkNet smart contracts.

- [precision.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/precision.cairo): Provides utility functions for high precision arithmetic and conversion operations, facilitating precise calculations and conversions between different units, such as from float to wei, applying factors, and handling rounding in the Satoru StarkNet smart contract environment.

- [span32.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/span32.cairo): Provides utility functions for managing and manipulating fixed-size arrays (span32) and facilitating serialization and deserialization of these arrays, including handling of storage reads and writes in the Satoru StarkNet smart contract environment. 

- [starknet_utils.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/starknet_utils.cairo): Implements mock utilities for simulating StarkNet environment functionalities, such as `gasleft` and `tx.gasprice`, in the Satoru StarkNet smart contract environment. These functions return predefined values based on the given parameters, providing a way to emulate StarkNet gas mechanics during testing and development. 

- [store_arrays.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/store_arrays.cairo): Provides implementations for reading and writing various types of arrays, including arrays of `ContractAddress`, `Market`, `Price`, `u128`, `u64`, and `felt252`, to and from the StarkNet storage. This utility aids in the structured storage of different data types, allowing efficient access and modification, essential for the operation of smart contracts within the Satoru project.

- [test_pricing_utils.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/test_pricing_utils.cairo): This file contains skeleton test cases for various functions related to pricing utilities in the Satoru project. These tests are designed to validate the correct functioning of methods such as `apply_impact_factor`, `get_price_impact_usd_for_same_side_rebalance`, and `get_price_impact_usd_for_crossover_rebalance`. However, the implementations of the tests seem to be pending, as they currently only contain placeholder assertions.

- [traits.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/traits.cairo): This file contains the implementation of a default constructor for the `ContractAddress` type from the StarkNet library. It utilizes the `Default` trait to provide a method, `default()`, that returns a constant `ContractAddress` initialized with a value of `0`. This utility can be helpful when there's a need to instantiate a `ContractAddress` with a default value in the absence of a specific address.

- [u128_mask.cairo](https://github.com/keep-starknet-strange/satoru/blob/main/src/utils/u128_mask.cairo): This file defines a `Mask` struct and associated functionality to validate that a given index is unique within a 128-bit range. The `Mask` struct has a `bits` field representing a 128-bit unsigned integer. The `validate_unique_and_set_index` function takes a mask and an index and validates whether the bit at the specified index is unique and not set. If the bit is already set or if the index is out of bounds, the function will panic with a corresponding error. Otherwise, it sets the bit at the specified index in the mask, indicating that this index is now occupied. This utility can be useful for managing and verifying the uniqueness of indices in a 128-bit range.